<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CSV Graph & Table Viewer</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #eef6fb;
      margin: 0;
      padding: 20px;
    }

    .container {
      background: white;
      padding: 30px;
      max-width: 1000px;
      margin: auto;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      position: relative;
    }

    /* Top-right link button */
    .top-right-link {
      position: absolute;
      top: 20px;
      right: 30px;
    }
    .top-right-link a {
      display: inline-block;
      padding: 10px 16px;
      background-color: #2c4637;
      color: white;
      border-radius: 6px;
      text-decoration: none;
      font-weight: bold;
      font-size: 14px;
      transition: background-color 0.3s ease;
    }
    .top-right-link a:hover {
      background-color: #232d27;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 25px;
    }

    input[type="file"],
    select,
    button {
      margin: 10px 5px;
      padding: 10px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    button {
      background-color: #2980b9;
      color: white;
      border: none;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover:not(:disabled) {
      background-color: #3498db;
    }

    button:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }

    canvas {
      margin-top: 30px;
      background-color: #f9fbff;
      border-radius: 10px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }

    table {
      width: 100%;
      margin-top: 30px;
      border-collapse: collapse;
    }

    th, td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: center;
    }

    th {
      background-color: #ecf4fb;
      font-weight: bold;
    }

    #controls, #operation-controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 20px;
    }

    .form-control {
      margin: 10px;
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- Top-right link button -->
    <div class="top-right-link">
      <a href="https://www.w3schools.com/python/data.csv" target="_blank" rel="noopener noreferrer">Download CSV(Demo)</a>
    </div>

    <h1>Upload CSV to View Graph and Table</h1>
    <input type="file" id="csv-file" multiple />

    <div id="controls" style="display:none;">
      <div class="form-control">
        <select id="x-axis-column"></select>
      </div>
      <div class="form-control">
        <select id="y-axis-column"></select>
      </div>
      <div class="form-control">
        <select id="graph-type">
          <option value="line">Line</option>
          <option value="bar">Bar</option>
          <option value="pie">Pie</option>
        </select>
      </div>
    </div>

    <div id="operation-controls" style="display:none;">
      <div class="form-control">
        <select id="operation-type">
          <option value="sum">Sum</option>
          <option value="min">Minimum</option>
          <option value="max">Maximum</option>
        </select>
      </div>
      <button id="apply-operation-btn" disabled>Apply Operation</button>
    </div>

    <div style="text-align:center;">
      <button id="run-btn" disabled>Show Graph</button>
      <button id="table-btn" disabled>Show Table</button>
      <button id="save-btn" style="display:none;">Save Graph</button>
      <button id="reset-zoom-btn" style="display:none;">Reset Zoom</button>
      <button id="download-csv-btn" style="display:none;">Download Table</button>
      <button id="hide-table-btn" style="display:none;">Hide Table</button>
    </div>

    <canvas id="myChart" style="display:none;"></canvas>

    <table id="table-view" style="display:none;">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    $(document).ready(function () {
      let chart;
      let allData = [];
      let combinedData = [];
      let columns = [];

      $('#csv-file').on('change', function (e) {
        const files = e.target.files;
        allData = [];
        combinedData = [];

        Array.from(files).forEach(file => {
          const reader = new FileReader();
          reader.onload = function (event) {
            const parsed = parseCSV(event.target.result);
            allData.push(parsed);
            combinedData = combinedData.concat(parsed);
            columns = Object.keys(parsed[0]);
            populateColumnSelectors(columns);
            $('#controls, #operation-controls').show();
            $('#run-btn, #table-btn, #apply-operation-btn').prop('disabled', false);
          };
          reader.readAsText(file);
        });
      });

      function parseCSV(csv) {
        const lines = csv.trim().split('\n');
        const headers = lines[0].split(',');
        return lines.slice(1).map(line => {
          const values = line.split(',');
          const obj = {};
          headers.forEach((header, i) => {
            obj[header] = values[i];
          });
          return obj;
        });
      }

      function populateColumnSelectors(cols) {
        $('#x-axis-column, #y-axis-column').empty();
        cols.forEach(col => {
          $('#x-axis-column, #y-axis-column').append(new Option(col, col));
        });
      }

      function updateGraph(data) {
        const xCol = $('#x-axis-column').val();
        const yCol = $('#y-axis-column').val();
        const graphType = $('#graph-type').val();

        const labels = data.map(row => row[xCol]);
        const values = data.map(row => parseFloat(row[yCol]) || 0);

        if (chart) chart.destroy();

        const ctx = $('#myChart')[0].getContext('2d');
        chart = new Chart(ctx, {
          type: graphType,
          data: {
            labels: labels,
            datasets: [{
              label: yCol,
              data: values,
              backgroundColor: graphType === 'pie' ? 'rgba(241, 196, 15, 0.7)' : 'rgba(41, 128, 185, 0.4)',
              borderColor: 'rgba(41, 128, 185, 1)',
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            animation: {
              duration: 1000,
              easing: 'easeInOutQuad'
            },
            plugins: {
              zoom: {
                pan: {
                  enabled: true,
                  mode: 'x'
                },
                zoom: {
                  wheel: {
                    enabled: true,
                    speed: 0.05
                  },
                  pinch: {
                    enabled: true
                  },
                  mode: 'x'
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  precision: 2
                }
              }
            }
          }
        });

        $('#myChart').show();
        $('#table-view').hide();
        $('#save-btn, #reset-zoom-btn').show();
        $('#hide-table-btn').hide();
        $('#download-csv-btn').hide();
      }

      function updateTable(data) {
        const headers = Object.keys(data[0]);
        const headRow = headers.map(h => `<th>${h}</th>`).join('');
        const rows = data.map(row => {
          return `<tr>${headers.map(h => `<td>${row[h]}</td>`).join('')}</tr>`;
        }).join('');
        $('#table-view thead').html(`<tr>${headRow}</tr>`);
        $('#table-view tbody').html(rows);
        $('#myChart').hide();
        $('#table-view').show();
        $('#save-btn, #reset-zoom-btn').hide();
        $('#download-csv-btn, #hide-table-btn').show();
      }

      $('#run-btn').click(() => updateGraph(combinedData));
      $('#table-btn').click(() => updateTable(combinedData));
      $('#hide-table-btn').click(function () {
        $('#table-view').toggle();
        $('#myChart').toggle();
        const visible = $('#table-view').is(':visible');
        $(this).text(visible ? "Hide Table" : "Show Table");
        $('#save-btn, #reset-zoom-btn').toggle(!visible);
        $('#download-csv-btn').toggle(visible);
      });

      $('#save-btn').click(() => {
        const link = document.createElement('a');
        link.href = chart.toBase64Image();
        link.download = "chart.png";
        link.click();
      });

      $('#reset-zoom-btn').click(() => {
        chart.resetZoom();
      });

      $('#download-csv-btn').click(() => {
        let csv = '';
        $('#table-view thead tr th').each(function () {
          csv += $(this).text() + ',';
        });
        csv = csv.slice(0, -1) + '\n';

        $('#table-view tbody tr').each(function () {
          $(this).find('td').each(function () {
            csv += $(this).text() + ',';
          });
          csv = csv.slice(0, -1) + '\n';
        });

        const blob = new Blob([csv], { type: 'text/csv' });
        const link = document.createElement('a');
        link.href = window.URL.createObjectURL(blob);
        link.download = 'table.csv';
        link.click();
      });

      $('#apply-operation-btn').click(() => {
        const yCol = $('#y-axis-column').val();
        const operation = $('#operation-type').val();
        const values = combinedData.map(r => parseFloat(r[yCol]) || 0);
        let result = 0;

        if (operation === 'sum') result = values.reduce((a, b) => a + b, 0);
        else if (operation === 'min') result = Math.min(...values);
        else if (operation === 'max') result = Math.max(...values);

        $('#table-view tbody').append(`<tr><td colspan="100%">Operation (${operation}): ${result.toFixed(2)}</td></tr>`);
      });
    });
  </script>
</body>
</html>
